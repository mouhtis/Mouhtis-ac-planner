<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mouhtis HVAC Suite</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3f4f6;--card:#ffffff;--accent:#0b74de;--accent-soft:#e0edff;
      --muted:#6b7280;--border:#e5e7eb;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,sans-serif}
    body{margin:0;background:var(--bg);color:#111;}
    header{display:flex;align-items:center;justify-content:space-between;
      padding:12px 18px;background:#fff;border-bottom:1px solid var(--border);}
    header h1{margin:0;font-size:18px;}
    header .subtitle{font-size:12px;color:var(--muted);}
    .layout{display:flex;min-height:calc(100vh - 54px);}
    .sidebar{width:230px;background:#020617;color:#e5e7eb;padding:14px 10px;}
    .brand{font-size:14px;font-weight:600;margin-bottom:10px;padding:6px 10px;}
    .nav-btn{display:flex;align-items:center;width:100%;border:none;
      background:transparent;color:#e5e7eb;text-align:left;padding:8px 10px;
      border-radius:8px;font-size:14px;margin-bottom:4px;cursor:pointer;}
    .nav-btn.active{background:rgba(148,163,184,0.2);}
    .nav-btn span.icon{width:18px;margin-right:8px;text-align:center;}
    main{flex:1;padding:16px;overflow:auto;}
    .cards{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:16px;}
    .card{background:var(--card);border-radius:12px;border:1px solid var(--border);
      padding:10px 12px;flex:1;min-width:200px;}
    .card h3{margin:0 0 6px 0;font-size:14px;}
    .card p{margin:0;font-size:13px;color:var(--muted);}
    .btn{border:none;border-radius:999px;padding:7px 12px;font-size:13px;
      cursor:pointer;background:var(--accent);color:#fff;}
    .btn.secondary{background:#fff;color:var(--accent);border:1px solid var(--accent-soft);}
    .btn.small{padding:4px 8px;font-size:12px;}
    .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
    .section-title h2{margin:0;font-size:17px;}
    .section-title span{font-size:12px;color:var(--muted);}
    .grid{display:grid;grid-template-columns:minmax(0,2fr) minmax(0,3fr);gap:14px;}
    .panel{background:var(--card);border-radius:12px;border:1px solid var(--border);padding:10px 12px;}
    .panel h3{margin:0 0 8px 0;font-size:14px;}
    label{display:block;font-size:12px;color:var(--muted);margin-top:6px;margin-bottom:2px;}
    input,textarea,select{
      width:100%;padding:6px 8px;border-radius:8px;border:1px solid var(--border);
      font-size:13px;
    }
    textarea{resize:vertical;min-height:60px;}
    table{width:100%;border-collapse:collapse;font-size:13px;margin-top:4px;}
    th,td{padding:6px 4px;border-bottom:1px solid #f1f5f9;text-align:left;}
    th{font-size:12px;color:var(--muted);}
    .tag{display:inline-flex;align-items:center;border-radius:999px;background:#f1f5f9;
      padding:2px 8px;font-size:11px;color:#374151;margin-right:4px;}
    .pill{border-radius:999px;padding:2px 8px;font-size:11px;}
    .pill.green{background:#dcfce7;color:#166534;}
    .pill.red{background:#fee2e2;color:#b91c1c;}
    .pill.orange{background:#ffedd5;color:#9a3412;}
    .muted{color:var(--muted);font-size:12px;}
    .link{color:var(--accent);cursor:pointer;font-size:12px;}
    .toolbar-row{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px;align-items:center;}
    @media(max-width:900px){
      .layout{flex-direction:column;}
      .sidebar{width:100%;display:flex;overflow-x:auto;}
      .brand{display:none;}
      .nav-btn{white-space:nowrap;flex:1;justify-content:center;}
      .grid{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
<header>
  <div>
    <h1>Mouhtis HVAC Suite</h1>
    <div class="subtitle">Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î­ÏÎ³Ï‰Î½, Ï€ÎµÎ»Î±Ï„ÏÎ½, ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÏ‰Î½ & AC Planner</div>
  </div>
  <button class="btn small" id="openAcPlanner">Î†Î½Î¿Î¹Î³Î¼Î± AC Planner</button>
</header>

<div class="layout">
  <aside class="sidebar">
    <div class="brand">Mouhtis Tools</div>
    <button class="nav-btn active" data-view="dashboard">
      <span class="icon">ğŸ </span> Dashboard
    </button>
    <button class="nav-btn" data-view="clients">
      <span class="icon">ğŸ‘¤</span> Î ÎµÎ»Î¬Ï„ÎµÏ‚
    </button>
    <button class="nav-btn" data-view="projects">
      <span class="icon">ğŸ“‹</span> ÎˆÏÎ³Î±
    </button>
    <button class="nav-btn" data-view="maintenance">
      <span class="icon">ğŸ› ï¸</span> Î£Ï…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚
    </button>
  </aside>

  <main>
    <!-- DASHBOARD -->
    <section id="view-dashboard">
      <div class="section-title">
        <h2>Dashboard</h2>
        <span id="todayLabel"></span>
      </div>

      <div class="cards">
        <div class="card">
          <h3>Î£ÏÎ½Î¿ÏˆÎ·</h3>
          <p>
            Î ÎµÎ»Î¬Ï„ÎµÏ‚: <strong id="statClients">0</strong><br>
            ÎˆÏÎ³Î±: <strong id="statProjects">0</strong><br>
            Î‘Î½Î¿Î¹Ï‡Ï„Î­Ï‚ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚: <strong id="statMaint">0</strong>
          </p>
        </div>
        <div class="card">
          <h3>Î“ÏÎ®Î³Î¿ÏÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</h3>
          <p>
            <button class="btn small" data-open="clients">ÎÎ­Î¿Ï‚ Ï€ÎµÎ»Î¬Ï„Î·Ï‚</button>
            <button class="btn small" data-open="projects">ÎÎ­Î¿ Î­ÏÎ³Î¿</button>
            <button class="btn small" data-open="maintenance">ÎÎ­Î± ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·</button>
          </p>
        </div>
        <div class="card">
          <h3>Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ AC Planner</h3>
          <p class="muted">
            Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ Mouhtis AC Planner Î³Î¹Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ BTU ÎºÎ±Î¹ Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Î¼Î¿Î½Î¬Î´Ï‰Î½.
          </p>
          <button class="btn secondary small" id="openAcPlanner2">Î†Î½Î¿Î¹Î³Î¼Î± AC Planner</button>
        </div>
      </div>

      <div class="grid">
        <div class="panel">
          <h3>Î•Ï€ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚</h3>
          <div id="dashMaint" class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚.</div>
        </div>
        <div class="panel">
          <h3>Î ÏÏŒÏƒÏ†Î±Ï„Î± Î­ÏÎ³Î±</h3>
          <div id="dashProjects" class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¼Î­Î½Î± Î­ÏÎ³Î±.</div>
        </div>
      </div>
    </section>

    <!-- CLIENTS -->
    <section id="view-clients" style="display:none">
      <div class="section-title">
        <h2>Î ÎµÎ»Î¬Ï„ÎµÏ‚</h2>
        <span>ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Ï€ÎµÎ»Î±Ï„ÏÎ½ & Ï‡ÏÏÏ‰Î½</span>
      </div>
      <div class="grid">
        <div class="panel">
          <h3>ÎÎ­Î¿Ï‚ / Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï€ÎµÎ»Î¬Ï„Î·</h3>
          <label>ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿</label>
          <input id="cl-name" placeholder="Ï€.Ï‡. Î“Î¹Î¬Î½Î½Î·Ï‚ Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚" />
          <label>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</label>
          <input id="cl-phone" placeholder="69xxxxxxxx" />
          <label>Email</label>
          <input id="cl-email" placeholder="example@mail.com" />
          <label>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</label>
          <input id="cl-address" placeholder="ÎŸÎ´ÏŒÏ‚, Î±ÏÎ¹Î¸Î¼ÏŒÏ‚, Ï€ÏŒÎ»Î·" />
          <label>Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</label>
          <textarea id="cl-notes" placeholder="Î•Î¯Î´Î¿Ï‚ Ï‡ÏÏÎ¿Ï…, ÏÏÎµÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ ÎºÎ»Ï€."></textarea>
          <div style="margin-top:8px;display:flex;gap:8px;">
            <button class="btn small" id="cl-save">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
            <button class="btn secondary small" id="cl-clear">ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
          </div>
          <div id="cl-msg" class="muted" style="margin-top:6px;"></div>
        </div>
        <div class="panel">
          <h3>Î›Î¯ÏƒÏ„Î± Ï€ÎµÎ»Î±Ï„ÏÎ½</h3>
          <div id="clientsTableWrap" class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î·.</div>
        </div>
      </div>
    </section>

    <!-- PROJECTS -->
    <section id="view-projects" style="display:none">
      <div class="section-title">
        <h2>ÎˆÏÎ³Î±</h2>
        <span>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î­ÏÎ³Ï‰Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ / ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·Ï‚</span>
      </div>
      <div class="grid">
        <div class="panel">
          <h3>ÎÎ­Î¿ / Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î­ÏÎ³Î¿Ï…</h3>
          <label>Î ÎµÎ»Î¬Ï„Î·Ï‚</label>
          <select id="pr-client"></select>
          <label>Î¤Î¯Ï„Î»Î¿Ï‚ Î­ÏÎ³Î¿Ï…</label>
          <input id="pr-title" placeholder="Ï€.Ï‡. Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· 2x12.000 BTU" />
          <label>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</label>
          <input id="pr-location" placeholder="Ï€.Ï‡. Î”Î¹Î±Î¼Î­ÏÎ¹ÏƒÎ¼Î± Î¤ÏƒÎ¹Î¼Î¹ÏƒÎºÎ® 12" />
          <label>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</label>
          <select id="pr-type">
            <option value="install">Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</option>
            <option value="service">Service / Î’Î»Î¬Î²Î·</option>
            <option value="maintenance">Î ÏÎ¿Î»Î·Ï€Ï„Î¹ÎºÎ® ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·</option>
          </select>
          <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
          <input id="pr-date" type="date" />
          <label>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</label>
          <select id="pr-status">
            <option value="open">Î‘Î½Î¿Î¹Ï‡Ï„ÏŒ</option>
            <option value="inprogress">Î£Îµ ÎµÎ¾Î­Î»Î¹Î¾Î·</option>
            <option value="done">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î¿</option>
          </select>
          <label>Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ / ÎµÎ¾Î¿Ï€Î»Î¹ÏƒÎ¼ÏŒÏ‚</label>
          <textarea id="pr-notes" placeholder="ÎœÎ¿Î½Ï„Î­Î»Î± ÎºÎ»Î¹Î¼Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½, Î±ÎµÏÎ±Î³Ï‰Î³Î¿Î¯, ÎµÎ¹Î´Î¹ÎºÎ­Ï‚ Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚."></textarea>
          <div style="margin-top:8px;display:flex;gap:8px;">
            <button class="btn small" id="pr-save">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
            <button class="btn secondary small" id="pr-clear">ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
          </div>
          <div id="pr-msg" class="muted" style="margin-top:6px;"></div>
        </div>
        <div class="panel">
          <h3>Î›Î¯ÏƒÏ„Î± Î­ÏÎ³Ï‰Î½</h3>
          <div class="toolbar-row">
            <span class="muted">Î¦Î¯Î»Ï„ÏÎ¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚:</span>
            <select id="pr-filter" style="width:auto;min-width:120px;">
              <option value="all">ÎŒÎ»Î±</option>
              <option value="open">Î‘Î½Î¿Î¹Ï‡Ï„Î¬</option>
              <option value="inprogress">Î£Îµ ÎµÎ¾Î­Î»Î¹Î¾Î·</option>
              <option value="done">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î±</option>
            </select>
          </div>
          <div id="projectsTableWrap" class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î­ÏÎ³Î± Î±ÎºÏŒÎ¼Î·.</div>
        </div>
      </div>
    </section>

    <!-- MAINTENANCE -->
    <section id="view-maintenance" style="display:none">
      <div class="section-title">
        <h2>Î£Ï…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚</h2>
        <span>Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ & Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÏ‰Î½</span>
      </div>
      <div class="grid">
        <div class="panel">
          <h3>ÎÎ­Î± ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·</h3>
          <label>Î ÎµÎ»Î¬Ï„Î·Ï‚</label>
          <select id="mt-client"></select>
          <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
          <input type="date" id="mt-date" />
          <label>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label>
          <textarea id="mt-desc" placeholder="ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï†Î¯Î»Ï„ÏÏ‰Î½, Î­Î»ÎµÎ³Ï‡Î¿Ï‚ ÏˆÏ…ÎºÏ„Î¹ÎºÎ¿Ï, Î³ÎµÎ½Î¹ÎºÎ® ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·."></textarea>
          <label>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</label>
          <select id="mt-status">
            <option value="open">Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î·</option>
            <option value="done">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î·</option>
          </select>
          <div style="margin-top:8px;display:flex;gap:8px;">
            <button class="btn small" id="mt-save">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
            <button class="btn secondary small" id="mt-clear">ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
          </div>
          <div id="mt-msg" class="muted" style="margin-top:6px;"></div>
        </div>
        <div class="panel">
          <h3>Î›Î¯ÏƒÏ„Î± ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÏ‰Î½</h3>
          <div class="toolbar-row">
            <span class="muted">Î¦Î¯Î»Ï„ÏÎ¿:</span>
            <select id="mt-filter" style="width:auto;min-width:120px;">
              <option value="upcoming">Î•Ï€ÎµÏÏ‡ÏŒÎ¼ÎµÎ½ÎµÏ‚</option>
              <option value="all">ÎŒÎ»ÎµÏ‚</option>
            </select>
          </div>
          <div id="mtTableWrap" class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚ Î±ÎºÏŒÎ¼Î·.</div>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  // ---------- Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ‘ ----------
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  const STORAGE_KEY = 'mouhtis_hvac_suite_v1';
  let state = {
    clients: [],
    projects: [],
    maintenance: [],
    currentClientId: null,
    currentProjectId: null,
    currentMaintId: null
  };

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) state = Object.assign(state, JSON.parse(raw));
    }catch(e){}
  }
  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    refreshStats();
  }

  function formatDate(d){
    if(!d) return '';
    const parts = d.split('-');
    if(parts.length!==3) return d;
    return `${parts[2]}/${parts[1]}/${parts[0]}`;
  }

  // ---------- NAV ----------
  function showView(id){
    $$('.nav-btn').forEach(b=>b.classList.toggle('active', b.dataset.view===id));
    ['dashboard','clients','projects','maintenance'].forEach(v=>{
      const s = $('#view-'+v);
      if(s) s.style.display = (v===id)?'block':'none';
    });
    if(id==='clients') renderClients();
    if(id==='projects') renderProjects();
    if(id==='maintenance') renderMaintenance();
  }

  $$('.nav-btn').forEach(b=>{
    b.addEventListener('click',()=>showView(b.dataset.view));
  });

  // quick open from dashboard
  $('[data-open="clients"]').onclick = ()=>showView('clients');
  $('[data-open="projects"]').onclick = ()=>showView('projects');
  $('[data-open="maintenance"]').onclick = ()=>showView('maintenance');

  // ---------- AC PLANNER LINKS ----------
  function openPlanner(){
    window.open('https://mouhtis.github.io/mouhtis-ac-planner/','_blank');
  }
  $('#openAcPlanner').onclick = openPlanner;
  $('#openAcPlanner2').onclick = openPlanner;

  // ---------- CLIENTS ----------
  function clearClientForm(){
    state.currentClientId = null;
    $('#cl-name').value='';
    $('#cl-phone').value='';
    $('#cl-email').value='';
    $('#cl-address').value='';
    $('#cl-notes').value='';
    $('#cl-msg').textContent='';
  }

  $('#cl-clear').onclick = clearClientForm;

  $('#cl-save').onclick = ()=>{
    const name = $('#cl-name').value.trim();
    if(!name){ $('#cl-msg').textContent='Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏŒÎ½Î¿Î¼Î±.'; return; }
    const obj = {
      id: state.currentClientId || ('c_'+Date.now()),
      name,
      phone: $('#cl-phone').value.trim(),
      email: $('#cl-email').value.trim(),
      address: $('#cl-address').value.trim(),
      notes: $('#cl-notes').value.trim()
    };
    const idx = state.clients.findIndex(c=>c.id===obj.id);
    if(idx>=0) state.clients[idx]=obj; else state.clients.push(obj);
    state.currentClientId = obj.id;
    $('#cl-msg').textContent='Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ.';
    saveState();
    renderClients();
    populateClientSelects();
  };

  function renderClients(){
    const wrap = $('#clientsTableWrap');
    if(!state.clients.length){
      wrap.innerHTML='Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚.';
      return;
    }
    let html = '<table><thead><tr><th>ÎŒÎ½Î¿Î¼Î±</th><th>Î¤Î·Î»</th><th>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</th><th></th></tr></thead><tbody>';
    state.clients.forEach(c=>{
      html += `<tr>
        <td>${c.name}</td>
        <td>${c.phone||''}</td>
        <td>${c.address||''}</td>
        <td><span class="link" data-edit-client="${c.id}">Î•Ï€ÎµÎ¾.</span></td>
      </tr>`;
    });
    html += '</tbody></table>';
    wrap.innerHTML = html;
    $$('#clientsTableWrap [data-edit-client]').forEach(el=>{
      el.onclick = ()=>{
        const c = state.clients.find(x=>x.id===el.dataset.editClient);
        if(!c) return;
        state.currentClientId = c.id;
        $('#cl-name').value=c.name;
        $('#cl-phone').value=c.phone||'';
        $('#cl-email').value=c.email||'';
        $('#cl-address').value=c.address||'';
        $('#cl-notes').value=c.notes||'';
        $('#cl-msg').textContent='Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï€ÎµÎ»Î¬Ï„Î·.';
        showView('clients');
      };
    });
  }

  function populateClientSelects(){
    const selects = [$('#pr-client'), $('#mt-client')];
    selects.forEach(sel=>{
      if(!sel) return;
      const current = sel.value;
      sel.innerHTML = '';
      const optEmpty = document.createElement('option');
      optEmpty.value='';
      optEmpty.textContent='â€” Î•Ï€Î¹Î»Î¿Î³Î® Ï€ÎµÎ»Î¬Ï„Î· â€”';
      sel.appendChild(optEmpty);
      state.clients.forEach(c=>{
        const o = document.createElement('option');
        o.value=c.id;
        o.textContent=c.name;
        sel.appendChild(o);
      });
      if(current) sel.value=current;
    });
  }

  // ---------- PROJECTS ----------
  function clearProjectForm(){
    state.currentProjectId=null;
    $('#pr-client').value='';
    $('#pr-title').value='';
    $('#pr-location').value='';
    $('#pr-type').value='install';
    $('#pr-date').value='';
    $('#pr-status').value='open';
    $('#pr-notes').value='';
    $('#pr-msg').textContent='';
  }
  $('#pr-clear').onclick = clearProjectForm;

  $('#pr-save').onclick = ()=>{
    const title = $('#pr-title').value.trim();
    if(!title){ $('#pr-msg').textContent='Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¯Ï„Î»Î¿ Î­ÏÎ³Î¿Ï….'; return; }
    const obj = {
      id: state.currentProjectId || ('p_'+Date.now()),
      clientId: $('#pr-client').value || '',
      title,
      location: $('#pr-location').value.trim(),
      type: $('#pr-type').value,
      date: $('#pr-date').value,
      status: $('#pr-status').value,
      notes: $('#pr-notes').value.trim()
    };
    const idx = state.projects.findIndex(p=>p.id===obj.id);
    if(idx>=0) state.projects[idx]=obj; else state.projects.push(obj);
    state.currentProjectId = obj.id;
    $('#pr-msg').textContent='Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ.';
    saveState();
    renderProjects();
  };

  function renderProjects(){
    const wrap = $('#projectsTableWrap');
    if(!state.projects.length){
      wrap.innerHTML='Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î­ÏÎ³Î±.';
      return;
    }
    const filter = $('#pr-filter').value;
    let arr = state.projects.slice();
    if(filter!=='all') arr = arr.filter(p=>p.status===filter);
    arr.sort((a,b)=>(b.date||'').localeCompare(a.date||''));
    let html = '<table><thead><tr><th>Î—Î¼/Î½Î¯Î±</th><th>Î ÎµÎ»Î¬Ï„Î·Ï‚</th><th>Î¤Î¯Ï„Î»Î¿Ï‚</th><th>Î¤ÏÏ€Î¿Ï‚</th><th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th><th></th></tr></thead><tbody>';
    arr.forEach(p=>{
      const cl = state.clients.find(c=>c.id===p.clientId);
      const statusPill =
        p.status==='done' ? '<span class="pill green">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î¿</span>' :
        p.status==='inprogress' ? '<span class="pill orange">Î£Îµ ÎµÎ¾Î­Î»Î¹Î¾Î·</span>' :
        '<span class="pill red">Î‘Î½Î¿Î¹Ï‡Ï„ÏŒ</span>';
      const typeTag =
        p.type==='install' ? 'Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·' :
        p.type==='service' ? 'Service' :
        'Î£Ï…Î½Ï„Î®ÏÎ·ÏƒÎ·';
      html += `<tr>
        <td>${formatDate(p.date||'')}</td>
        <td>${cl?cl.name:'â€”'}</td>
        <td>${p.title}</td>
        <td>${typeTag}</td>
        <td>${statusPill}</td>
        <td><span class="link" data-edit-project="${p.id}">Î•Ï€ÎµÎ¾.</span></td>
      </tr>`;
    });
    html += '</tbody></table>';
    wrap.innerHTML = html;
    $$('#projectsTableWrap [data-edit-project]').forEach(el=>{
      el.onclick = ()=>{
        const p = state.projects.find(x=>x.id===el.dataset.editProject);
        if(!p) return;
        state.currentProjectId = p.id;
        $('#pr-client').value=p.clientId||'';
        $('#pr-title').value=p.title;
        $('#pr-location').value=p.location||'';
        $('#pr-type').value=p.type;
        $('#pr-date').value=p.date||'';
        $('#pr-status').value=p.status;
        $('#pr-notes').value=p.notes||'';
        $('#pr-msg').textContent='Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î­ÏÎ³Î¿Ï….';
        showView('projects');
      };
    });

    // Dashboard recent
    const dash = $('#dashProjects');
    const recent = state.projects.slice().sort((a,b)=>(b.date||'').localeCompare(a.date||'')).slice(0,5);
    if(!recent.length){ dash.textContent='Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¼Î­Î½Î± Î­ÏÎ³Î±.'; }
    else{
      let h = '<ul class="muted" style="padding-left:18px;margin:4px 0;">';
      recent.forEach(p=>{
        const cl = state.clients.find(c=>c.id===p.clientId);
        h += `<li>${formatDate(p.date||'')} â€¢ ${p.title} (${cl?cl.name:'â€”'})</li>`;
      });
      h += '</ul>';
      dash.innerHTML = h;
    }
  }
  $('#pr-filter').onchange = renderProjects;

  // ---------- MAINTENANCE ----------
  function clearMaintForm(){
    state.currentMaintId=null;
    $('#mt-client').value='';
    $('#mt-date').value='';
    $('#mt-desc').value='';
    $('#mt-status').value='open';
    $('#mt-msg').textContent='';
  }
  $('#mt-clear').onclick = clearMaintForm;

  $('#mt-save').onclick = ()=>{
    const date = $('#mt-date').value;
    if(!date){ $('#mt-msg').textContent='Î•Ï€Î¯Î»ÎµÎ¾Îµ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±.'; return; }
    const obj = {
      id: state.currentMaintId || ('m_'+Date.now()),
      clientId: $('#mt-client').value || '',
      date,
      desc: $('#mt-desc').value.trim(),
      status: $('#mt-status').value
    };
    const idx = state.maintenance.findIndex(m=>m.id===obj.id);
    if(idx>=0) state.maintenance[idx]=obj; else state.maintenance.push(obj);
    state.currentMaintId=obj.id;
    $('#mt-msg').textContent='Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ.';
    saveState();
    renderMaintenance();
  };

  function renderMaintenance(){
    const wrap = $('#mtTableWrap');
    if(!state.maintenance.length){
      wrap.innerHTML='Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚.';
      $('#dashMaint').textContent='Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚.';
      return;
    }
    const filter = $('#mt-filter').value;
    const today = new Date().toISOString().slice(0,10);
    let arr = state.maintenance.slice();
    if(filter==='upcoming'){
      arr = arr.filter(m=>m.date>=today && m.status!=='done');
    }
    arr.sort((a,b)=>(a.date||'').localeCompare(b.date||''));
    let html = '<table><thead><tr><th>Î—Î¼/Î½Î¯Î±</th><th>Î ÎµÎ»Î¬Ï„Î·Ï‚</th><th>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</th><th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th><th></th></tr></thead><tbody>';
    arr.forEach(m=>{
      const cl = state.clients.find(c=>c.id===m.clientId);
      const pill = m.status==='done'
        ? '<span class="pill green">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î·</span>'
        : '<span class="pill orange">Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î·</span>';
      html += `<tr>
        <td>${formatDate(m.date)}</td>
        <td>${cl?cl.name:'â€”'}</td>
        <td>${m.desc||''}</td>
        <td>${pill}</td>
        <td><span class="link" data-edit-maint="${m.id}">Î•Ï€ÎµÎ¾.</span></td>
      </tr>`;
    });
    html += '</tbody></table>';
    wrap.innerHTML = html;

    $$('#mtTableWrap [data-edit-maint]').forEach(el=>{
      el.onclick = ()=>{
        const m = state.maintenance.find(x=>x.id===el.dataset.editMaint);
        if(!m) return;
        state.currentMaintId=m.id;
        $('#mt-client').value=m.clientId||'';
        $('#mt-date').value=m.date;
        $('#mt-desc').value=m.desc||'';
        $('#mt-status').value=m.status;
        $('#mt-msg').textContent='Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·Ï‚.';
        showView('maintenance');
      };
    });

    // dashboard upcoming
    const upcoming = state.maintenance
      .filter(m=>m.date>=today && m.status!=='done')
      .sort((a,b)=>(a.date||'').localeCompare(b.date||''))
      .slice(0,5);
    const dash = $('#dashMaint');
    if(!upcoming.length){
      dash.textContent='Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚.';
    }else{
      let h = '<ul class="muted" style="padding-left:18px;margin:4px 0;">';
      upcoming.forEach(m=>{
        const cl = state.clients.find(c=>c.id===m.clientId);
        h += `<li>${formatDate(m.date)} â€¢ ${cl?cl.name:'â€”'} â€“ ${m.desc||''}</li>`;
      });
      h += '</ul>';
      dash.innerHTML = h;
    }
  }
  $('#mt-filter').onchange = renderMaintenance;

  // ---------- STATS & INIT ----------
  function refreshStats(){
    $('#statClients').textContent = state.clients.length;
    $('#statProjects').textContent = state.projects.length;
    const today = new Date().toISOString().slice(0,10);
    const openMaint = state.maintenance.filter(m=>m.date>=today && m.status!=='done').length;
    $('#statMaint').textContent = openMaint;
  }

  function initToday(){
    const d = new Date();
    const opts = {weekday:'short', day:'2-digit', month:'2-digit', year:'numeric'};
    $('#todayLabel').textContent = d.toLocaleDateString('el-GR',opts);
  }

  // ---------- STARTUP ----------
  loadState();
  initToday();
  refreshStats();
  renderClients();
  populateClientSelects();
  renderProjects();
  renderMaintenance();
  showView('dashboard');
</script>
</body>
</html>
