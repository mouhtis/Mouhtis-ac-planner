<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Mouhtis AC Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
font-family: Arial, sans-serif;
margin:0;
background:#f5f5f5;
}
header{
background:#1f2937;
color:#fff;
padding:15px;
text-align:center;
font-size:22px;
font-weight:bold;
}
main{
max-width:1100px;
margin:0 auto;
padding:20px;
}
section{
background:#fff;
padding:15px;
margin-bottom:20px;
border-radius:8px;
box-shadow:0 2px 4px rgba(0,0,0,0.1);
}
h2{
font-size:18px;
margin-top:0;
}
input[type="file"]{
margin:10px 0;
}
canvas{
display:block;
max-width:100%;
border:1px solid #ccc;
border-radius:6px;
background:#fff;
touch-action:none; /* ΣΗΜΑΝΤΙΚΟ ΓΙΑ ΚΙΝΗΤΟ */
}
button{
padding:10px 14px;
border:none;
border-radius:6px;
margin-right:10px;
cursor:pointer;
font-weight:bold;
margin-top:10px;
}
.drawbtn{background:#16a34a;color:#fff;}
.placebtn{background:#2563eb;color:#fff;}
.clearbtn{background:#dc2626;color:#fff;}
</style>
</head>

<body>
<header>Mouhtis AC Planner</header>

<main>

<section>
<h2>1. Ανέβασμα Κάτοψης</h2>
<input type="file" id="upload">
<canvas id="cv" width="1200" height="800"></canvas>
<button class="drawbtn" id="drawRoomBtn">Σχεδίαση Δωματίου</button>
<button class="placebtn" id="placeACBtn">Τοποθέτηση Κλιματιστικού</button>
<button class="clearbtn" id="clearBtn">Καθαρισμός</button>
</section>

<section>
<h2>2. Λίστα Δωματίων</h2>
<div id="roomsList">Δεν υπάρχουν δωμάτια ακόμα.</div>
</section>

<section>
<h2>3. Προτάσεις Κλιματιστικών</h2>
<div id="acResults">Δεν έχουν οριστεί δωμάτια.</div>
</section>

</main>

<script>
const upload = document.getElementById("upload");
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");

let img = null;
let rooms = [];
let acMarkers = [];
let mode = null;
let drawing = false;
let start = null;
let last = null;

// ----------------------------
// Φόρτωμα εικόνας κάτοψης
// ----------------------------
upload.addEventListener("change", e=>{
const file = e.target.files[0];
if(!file) return;
const r = new FileReader();
r.onload = ev=>{
img = new Image();
img.onload = ()=> drawAll();
img.src = ev.target.result;
};
r.readAsDataURL(file);
});

// ----------------------------
// Σχεδίαση όλων
// ----------------------------
function drawAll(){
ctx.clearRect(0,0,cv.width,cv.height);
if(img) ctx.drawImage(img,0,0,cv.width,cv.height);

// δωμάτια
rooms.forEach(r=>{
ctx.save();
ctx.strokeStyle="#16a34a";
ctx.lineWidth=2;
ctx.strokeRect(r.x,r.y,r.w,r.h);
ctx.restore();
});

// markers AC
acMarkers.forEach(m=>{
ctx.save();
ctx.fillStyle="#2563eb";
ctx.beginPath();
ctx.arc(m.x,m.y,8,0,Math.PI*2);
ctx.fill();
ctx.restore();
});
}

// ----------------------------
// Κουμπιά λειτουργιών
// ----------------------------
document.getElementById("drawRoomBtn").onclick = ()=>{
mode = "draw";
};
document.getElementById("placeACBtn").onclick = ()=>{
mode = "place";
};
document.getElementById("clearBtn").onclick = ()=>{
rooms=[];
acMarkers=[];
drawAll();
renderRoomsList();
renderACResults();
};

// ----------------------------
// Pointer event υποστήριξη (κινητό + PC)
// ----------------------------
function pointerToCanvas(e){
const rect = cv.getBoundingClientRect();
const clientX = e.clientX ?? (e.touches?.[0]?.clientX);
const clientY = e.clientY ?? (e.touches?.[0]?.clientY);
return {
x: (clientX - rect.left) * (cv.width / rect.width),
y: (clientY - rect.top) * (cv.height / rect.height)
};
}

cv.addEventListener("pointerdown", e=>{
e.preventDefault();
const p = pointerToCanvas(e);
last = p;

if(mode === "draw"){
drawing = true;
start = p;
}
else if(mode === "place"){
let idx=null;
rooms.forEach((r,i)=>{
if(p.x>=r.x && p.x<=r.x+r.w && p.y>=r.y && p.y<=r.y+r.h) idx = i;
});
acMarkers.push({x:p.x,y:p.y,roomIndex:idx});
drawAll();
renderACResults();
}
});

cv.addEventListener("pointermove", e=>{
const p = pointerToCanvas(e);
last = p;

if(mode==="draw" && drawing && start){
drawAll();
ctx.save();
ctx.strokeStyle="#16a34a";
ctx.setLineDash([6,4]);
ctx.strokeRect(start.x,start.y,p.x-start.x,p.y-start.y);
ctx.restore();
}
});

cv.addEventListener("pointerup", e=>{
e.preventDefault();
const p = pointerToCanvas(e);

if(mode==="draw" && drawing && start){
const nx = Math.min(start.x,p.x);
const ny = Math.min(start.y,p.y);
const nw = Math.abs(p.x-start.x);
const nh = Math.abs(p.y-start.y);

if(nw>20 && nh>20){
rooms.push({
x:nx, y:ny, w:nw, h:nh,
name:"",
area:"",
height:2.7,
windows:0,
ins:1.0
});
renderRoomsList();
}
start=null;
drawing=false;
drawAll();
}
});

// ----------------------------
// Render Rooms List
// ----------------------------
function renderRoomsList(){
const div = document.getElementById("roomsList");
if(rooms.length===0){ div.innerHTML="Δεν υπάρχουν δωμάτια."; return; }

div.innerHTML = rooms.map((r,i)=>`
<div style="margin-bottom:10px;padding:10px;border:1px solid #ddd;border-radius:6px;">
<strong>Δωμάτιο ${i+1}</strong><br>
Επιφάνεια (m²): <input type="number" value="${r.area}" onchange="updateRoomArea(${i},this.value)">
Ύψος: <input type="number" value="${r.height}" step="0.1" onchange="updateRoomHeight(${i},this.value)">
Παράθυρα: <input type="number" value="${r.windows}" onchange="updateRoomWindows(${i},this.value)">
Μόνωση (1=καλή, 2=μέτρια, 3=κακή):
<input type="number" value="${r.ins}" onchange="updateRoomIns(${i},this.value)">
</div>
`).join("");
}

function updateRoomArea(i,v){ rooms[i].area=parseFloat(v); renderACResults(); }
function updateRoomHeight(i,v){ rooms[i].height=parseFloat(v); renderACResults(); }
function updateRoomWindows(i,v){ rooms[i].windows=parseInt(v); renderACResults(); }
function updateRoomIns(i,v){ rooms[i].ins=parseFloat(v); renderACResults(); }

// ----------------------------
// Υπολογισμός BTU
// ----------------------------
function calculateBTU(r){
if(!r.area) return 0;
let base = r.area * 500;
base += r.windows * 600;
base *= r.ins;
return Math.round(base);
}

// ----------------------------
// Προτάσεις κλιματιστικών
// ----------------------------
function renderACResults(){
const div = document.getElementById("acResults");
if(rooms.length===0){ div.innerHTML="Δεν υπάρχουν δωμάτια."; return; }

const results = rooms.map((r,i)=>{
const btu = calculateBTU(r);

return `
<div style="margin-bottom:10px;padding:12px;border:1px solid #bbb;border-radius:6px;">
<strong>Δωμάτιο ${i+1}</strong><br>
Υπολογισμένα BTU: <strong>${btu}</strong><br>
Προτεινόμενα μοντέλα:
<ul>
<li><a target="_blank" href="https://www.skroutz.gr/search?key=9000+btu">9.000 BTU (Σύνδεσμος Skroutz)</a></li>
<li><a target="_blank" href="https://www.skroutz.gr/search?key=12000+btu">12.000 BTU (Σύνδεσμος Skroutz)</a></li>
<li><a target="_blank" href="https://www.skroutz.gr/search?key=18000+btu">18.000 BTU (Σύνδεσμος Skroutz)</a></li>
</ul>
</div>
`;
});

div.innerHTML = results.join("");
}

</script>

</body>
</html>
